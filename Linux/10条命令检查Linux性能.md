## 10条命令检查Linux性能

最近看微博发现一片在Linux圈很流行的文章叫"10条命令检查Linux性能"，于是我对这10条命令相当感兴趣，顺便对各个命令做下详细的介绍好了。  
文章链接：  
http://wkee.net/post/linux-performance.html  


uptime
------
解释load average（平均负载情况）后的三个数字：1分钟，5分钟，15分钟  
1分钟负载较高，15分钟负载较低，则说明服务器正在面临高负载的情况，CPU资源正在紧张，需要排查CPU的资源消耗在哪里  
```
#执行压测过程中的uptime
[root@VM_159_22_centos logs]# uptime
 16:50:11 up 23:02,  2 users,  load average: 66.48, 24.53, 36.78
[root@VM_159_22_centos logs]# uptime
 16:51:03 up 23:02,  2 users,  load average: 91.41, 37.97, 40.71
[root@VM_159_22_centos logs]# uptime
 16:52:16 up 23:04,  2 users,  load average: 116.89, 55.67, 46.57
```
1分钟负载较低，15分钟负载较高，则说明服务器的高负载情况过去，CPU资源正在缓解  
```
#停止压测后的uptime
[root@VM_159_22_centos logs]# uptime
 16:57:35 up 23:09,  2 users,  load average: 28.17, 58.97, 52.17
[root@VM_159_22_centos logs]# uptime
 16:57:37 up 23:09,  2 users,  load average: 25.92, 57.99, 51.89
[root@VM_159_22_centos logs]# uptime
 16:57:41 up 23:09,  2 users,  load average: 23.84, 57.03, 51.61
[root@VM_159_22_centos logs]# uptime
 16:58:38 up 23:10,  2 users,  load average: 9.52, 47.43, 48.64
[root@VM_159_22_centos logs]# uptime
 16:59:09 up 23:11,  2 users,  load average: 5.77, 42.90, 47.10
```


dmesg
-----
显示开机信息，同时也会保存在/var/log/dmesg文件中  
```
# 显示开机信息的最后十条信息
[root@ip-172-31-1-8 ~]# dmesg |tail
[    2.672858] evbug: Connected device: input2 (Power Button at LNXPWRBN/button/input0)
[    2.672859] evbug: Connected device: input3 (Sleep Button at LNXSLPBN/button/input0)
[    3.670982] input: ImExPS/2 Generic Explorer Mouse as /devices/platform/i8042/serio1/input/input4
[    3.675797] evbug: Connected device: input4 (ImExPS/2 Generic Explorer Mouse at isa0060/serio1/input0)
[    5.933678] EXT4-fs (xvda1): re-mounted. Opts: (null)
[    6.067840] ip_tables: (C) 2000-2006 Netfilter Core Team
[    6.073707] nf_conntrack version 0.5.0 (7964 buckets, 31856 max)
[    6.118031] NET: Registered protocol family 10
[    7.469579] random: nonblocking pool is initialized
[    8.440910] audit: type=1305 audit(1447402398.763:2): audit_pid=2063 old=0 auid=4294967295 ses=4294967295 res=1

# 显示开机信息利用正则表达式过滤后的信息
[root@ip-172-31-1-8 ~]# dmesg | grep -i net
[    0.000000] Netfront and the Xen platform PCI driver have been compiled for this kernel: unplug emulated NICs.
[    0.048007] Initializing cgroup subsys net_cls
[    0.051221] Initializing cgroup subsys net_prio
[    0.164193] NET: Registered protocol family 16
[    0.380478] NetLabel: Initializing
[    0.381885] NetLabel:  domain hash size = 128
[    0.383801] NetLabel:  protocols = UNLABELED CIPSOv4
[    0.384016] NetLabel:  unlabeled traffic allowed by default
[    0.441281] NET: Registered protocol family 2
[    0.456733] NET: Registered protocol family 1
[    0.697494] audit: initializing netlink subsys (disabled)
[    0.790387] xen_netfront: Initialising Xen virtual ethernet driver
[    0.819778] NET: Registered protocol family 17
[    6.067840] ip_tables: (C) 2000-2006 Netfilter Core Team
[    6.118031] NET: Registered protocol family 10
```


vmstat
------
vmstat命令是常用的Linux/Unix监控工具，可以展现给点时间间隔的服务器的状态值，包括服务器的CPU使用率，内存使用等等，与top的不同是，top看到的是各个CPU使用率，vmstat看到的是总体CPU使用率。  
```sql
# 每2秒采集一次服务器的状态，总共采集5次
[root@host-192-168-200-153 logs]# vmstat 2 5
procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 2  0      0 14361012  14600 530480    0    0     4     9   62  117  0  0 99  0  0
 4  0      0 14322284  14600 536084    0    0     0     0 20568 39009 10  7 81  0  2
 3  0      0 14287296  14608 542412    0    0     0    18 21127 41069 13  8 75  0  4
 1  0      0 14235668  14608 549392    0    0     0     0 23555 45623 12  9 75  0  4
 3  0      0 14206072  14608 555816    0    0     0     0 23593 44988 12  8 77  0  3
```
**对vmstat的输出结果进行解释：  **
##### procs  
r : 表示运行队列（即多少进程真正分配到了CPU）,当这个值超过了CPU数目，就会出现CPU瓶颈;  
b : 表示进程阻塞；（block）  
##### memory  
swpd : 虚拟内存使用的大小，如果大于0，则表示机器内存不够啦  
free : 空闲的物理内存  
buffer : 缓冲区大小  
cache : 告诉缓存大小  
（注意：buffer和cache也属于内存的一部分，他们会在free耗尽后释放，并提供给内存使用）  
##### swap  
si : 每秒从磁盘读入到虚拟内存的大小，如果该值大于0，则表示磁盘内存不足或者内存泄漏  
so : 每秒虚拟内存写入到磁盘的大小，如果该值大雨0，则表示磁盘内存不足或者内存泄漏  
##### io  
bi : 块设备每秒接受的块数量（读磁盘）  
bo : 块设备每秒发送的块数量（写磁盘）  
##### system  
in : 每秒CPU的中断次数  
cs : 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。  
##### cpu  
us : 用户进程消耗CPU的时间  
sy : 系统进程消耗CPU的时间  
id : 空闲CPU时间  
wa : IO等待CPU时间  
st : 被偷走的CPU时间  


mpstat
------
用于获取系统中每个CPU的占用情况，如果有一个CPU占用率特别高，那么有可能是一个单线程应用程序引起的。  
```shell
# 开启一个MySQL压测程序时的mpstat输出
[root@localhost ~]# mpstat -P ALL 5
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

01时35分27秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01时35分32秒  all   38.82    0.00   32.83    2.31    0.00   10.27    0.00    0.00    0.00   15.77
01时35分32秒    0   34.76    0.00   32.89    2.67    0.00   13.10    0.00    0.00    0.00   16.58
01时35分32秒    1   35.81    0.00   30.50    6.10    0.00   11.67    0.00    0.00    0.00   15.92
01时35分32秒    2   42.74    0.00   33.70    0.00    0.00    7.95    0.00    0.00    0.00   15.62
01时35分32秒    3   42.18    0.00   33.80    0.56    0.00    8.10    0.00    0.00    0.00   15.36

01时35分32秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01时35分37秒  all   36.39    0.00   20.34    6.29    0.00    7.41    0.00    0.00    0.00   29.57
01时35分37秒    0   33.49    0.00   20.28    6.37    0.00    8.73    0.00    0.00    0.00   31.13
01时35分37秒    1   34.11    0.00   19.95   18.10    0.00    8.35    0.00    0.00    0.00   19.49
01时35分37秒    2   39.67    0.00   20.19    0.00    0.00    5.23    0.00    0.00    0.00   34.92
01时35分37秒    3   38.24    0.00   21.38    0.48    0.00    6.89    0.00    0.00    0.00   33.02

01时35分37秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01时35分42秒  all   52.17    0.00   28.41    1.41    0.00    8.98    0.00    0.00    0.00    9.04
01时35分42秒    0   50.37    0.00   28.12    0.73    0.00   10.02    0.00    0.00    0.00   10.76
01时35分42秒    1   51.33    0.00   28.19    3.61    0.00    9.64    0.00    0.00    0.00    7.23
01时35分42秒    2   54.00    0.00   27.60    0.00    0.00    8.72    0.00    0.00    0.00    9.69
01时35分42秒    3   52.74    0.00   29.60    1.24    0.00    7.96    0.00    0.00    0.00    8.46

01时35分42秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01时35分47秒  all   42.36    0.00   23.46    3.55    0.00    8.35    0.00    0.00    0.00   22.27
01时35分47秒    0   40.24    0.00   23.53    2.12    0.00    9.18    0.00    0.00    0.00   24.94
01时35分47秒    1   40.24    0.00   23.29   11.29    0.00    9.41    0.00    0.00    0.00   15.76
01时35分47秒    2   45.15    0.00   23.40    0.00    0.00    7.09    0.00    0.00    0.00   24.35
01时35分47秒    3   44.12    0.00   23.50    0.48    0.00    7.67    0.00    0.00    0.00   24.22

01时35分47秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01时35分52秒  all   50.39    0.00   27.61    1.15    0.00    9.34    0.00    0.00    0.00   11.51
01时35分52秒    0   48.56    0.00   26.44    1.44    0.00   10.34    0.00    0.00    0.00   13.22
01时35分52秒    1   48.67    0.00   26.75    1.69    0.00   10.60    0.00    0.00    0.00   12.29
01时35分52秒    2   52.62    0.00   29.29    0.95    0.00    7.38    0.00    0.00    0.00    9.76
01时35分52秒    3   51.59    0.00   27.87    0.73    0.00    9.29    0.00    0.00    0.00   10.51

# 添加-P ALL的输出区别
[root@localhost ~]# mpstat
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

01时41分15秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01时41分15秒  all    5.00    0.00    3.36    1.30    0.00    1.85    0.00    0.00    0.00   88.50
[root@localhost ~]# mpstat -P ALL
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

01时41分25秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01时41分25秒  all    4.95    0.00    3.33    1.28    0.00    1.83    0.00    0.00    0.00   88.61
01时41分25秒    0    4.90    0.00    3.29    1.13    0.00    2.57    0.00    0.00    0.00   88.12
01时41分25秒    1    4.98    0.00    3.32    1.42    0.00    2.61    0.00    0.00    0.00   87.67
01时41分25秒    2    4.94    0.00    3.32    1.00    0.00    1.05    0.00    0.00    0.00   89.69
01时41分25秒    3    4.97    0.00    3.38    1.59    0.00    1.08    0.00    0.00    0.00   88.97

```
-P ALL显示所有CPU的统计信息。  
**对mpstat输出结果的解释：  **
##### %usr
表示处理用户进程所使用的CPU百分比。  
##### %nice
表示使用nice命令对进程进行降级时CPU的百分比。  
##### %sys
表示内核进程使用的CPU百分比。  
##### %iowait
表示等待进行I/O所使用的CPU百分比。  
##### %irq
表示用于处理系统中断的	CPU百分比。  
##### %soft
表示用于处理软件中断的CPU百分比。  
##### %steal

##### %guest

##### %gnice

##### %idle
表示空闲CPU的百分比。  


pidstat
-------
监控全部或者指定进程占用系统资源的情况，如CPU、内存等。pidstat首次运行时显示自系统启动开始的各项统计信息，之后运行自上次运行pidstat命令以后的信息。  
```shell
# 开启一个mysql压测程序的pidstat的输出
[root@localhost ~]# pidstat
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

01时53分38秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
01时53分38秒     0         1    0.01    0.08    0.00    0.10     3  systemd
01时53分38秒     0         3    0.00    0.02    0.00    0.02     0  ksoftirqd/0
01时53分38秒     0         7    0.00    0.02    0.00    0.02     0  migration/0
01时53分38秒     0       137    0.00    0.02    0.00    0.02     3  rcu_sched
01时53分38秒     0       138    0.00    0.01    0.00    0.01     0  rcuos/0
01时53分38秒     0       139    0.00    0.01    0.00    0.01     3  rcuos/1
01时53分38秒     0       140    0.00    0.01    0.00    0.01     3  rcuos/2
01时53分38秒     0       141    0.00    0.01    0.00    0.01     3  rcuos/3
01时53分38秒     0       266    0.00    0.00    0.00    0.00     0  watchdog/0
01时53分38秒     0       267    0.00    0.00    0.00    0.00     1  watchdog/1
01时53分38秒     0       268    0.00    0.02    0.00    0.02     1  migration/1
01时53分38秒     0       269    0.00    0.02    0.00    0.02     1  ksoftirqd/1
01时53分38秒     0       272    0.00    0.00    0.00    0.00     2  watchdog/2
01时53分38秒     0       273    0.00    0.01    0.00    0.01     2  migration/2
01时53分38秒     0       274    0.00    0.01    0.00    0.01     2  ksoftirqd/2
01时53分38秒     0       277    0.00    0.00    0.00    0.00     3  watchdog/3
01时53分38秒     0       278    0.00    0.01    0.00    0.01     3  migration/3
01时53分38秒     0       279    0.00    0.03    0.00    0.03     3  ksoftirqd/3
01时53分38秒     0       289    0.00    0.00    0.00    0.00     1  khubd
01时53分38秒     0       291    0.00    0.01    0.00    0.01     0  kworker/0:1
01时53分38秒     0       295    0.00    0.03    0.00    0.03     3  kswapd0
01时53分38秒     0       297    0.00    0.00    0.00    0.00     2  khugepaged
01时53分38秒     0       332    0.00    0.10    0.00    0.10     1  kworker/1:1
01时53分38秒     0       355    0.00    0.00    0.00    0.00     2  kauditd
01时53分38秒     0       428    0.00    0.14    0.00    0.14     3  kworker/3:2
01时53分38秒     0       550    0.00    0.00    0.00    0.00     0  scsi_eh_1
01时53分38秒     0       552    0.00    0.00    0.00    0.00     1  scsi_eh_2
01时53分38秒     0       653    0.00    0.05    0.00    0.05     3  kworker/u256:29
01时53分38秒     0       745    0.00    0.00    0.00    0.00     3  kworker/3:1H
01时53分38秒     0       746    0.00    0.03    0.00    0.03     1  xfsaild/dm-0
01时53分38秒     0       751    0.00    0.00    0.00    0.00     0  kworker/0:1H
01时53分38秒     0       822    0.00    0.01    0.00    0.01     1  systemd-journal
01时53分38秒     0       835    0.00    0.00    0.00    0.00     3  lvmetad
01时53分38秒     0       843    0.01    0.01    0.00    0.02     2  systemd-udevd
01时53分38秒     0       959    0.00    0.00    0.00    0.00     3  auditd
01时53分38秒     0       981    0.01    0.02    0.00    0.04     0  firewalld
01时53分38秒     0       986    0.00    0.01    0.00    0.01     2  irqbalance
01时53分38秒     0       987    0.00    0.01    0.00    0.01     3  rsyslogd
01时53分38秒     0       988    0.01    0.02    0.00    0.03     1  tuned
01时53分38秒     0       991    0.00    0.00    0.00    0.00     2  systemd-logind
01时53分38秒    81       992    0.00    0.01    0.00    0.01     0  dbus-daemon
01时53分38秒     0       996    0.00    0.03    0.00    0.03     0  crond
01时53分38秒     0      1099    0.00    0.01    0.00    0.01     2  NetworkManager
01时53分38秒   999      1300    0.00    0.00    0.00    0.00     0  polkitd
01时53分38秒     0      1580    0.00    0.00    0.00    0.00     1  dhclient
01时53分38秒     0      1608    0.00    0.00    0.00    0.00     0  sshd
01时53分38秒     0      2825    0.00    0.00    0.00    0.00     1  kworker/1:1H
01时53分38秒     0      2826    0.00    0.12    0.00    0.13     0  sshd
01时53分38秒     0      2830    0.00    0.00    0.00    0.00     0  bash
01时53分38秒     0      2851    0.01    0.01    0.00    0.01     1  bash
01时53分38秒     0      2878    0.00    0.01    0.00    0.01     1  mysqld_safe
01时53分38秒   998      4303    9.83    8.95    0.00   18.77     1  mysqld
01时53分38秒     0      4418    0.00    0.02    0.00    0.02     2  kworker/2:0
01时53分38秒     0      4509    0.00    0.17    0.00    0.17     0  kworker/u256:0
01时53分38秒     0      4642    0.00    0.01    0.00    0.01     2  kworker/2:1
01时53分38秒     0      4650    0.00    0.00    0.00    0.00     2  kworker/2:2
01时53分38秒     0      4689    0.69    0.58    0.00    1.27     3  java
01时53分38秒     0      4714    0.00    0.01    0.00    0.01     3  kworker/u256:1
01时53分38秒     0      4715    0.00    0.00    0.00    0.00     1  pidstat

# 输出指定pid(即指定进程)的输出
[root@localhost ~]# pidstat -p 4303 1
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

01时59分27秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
01时59分28秒   998      4303    0.00    0.99    0.00    0.99     1  mysqld
01时59分29秒   998      4303    1.00    0.00    0.00    1.00     1  mysqld
01时59分30秒   998      4303    0.00    0.00    0.00    0.00     1  mysqld
01时59分31秒   998      4303    0.00    1.00    0.00    1.00     1  mysqld
01时59分32秒   998      4303    1.00    0.00    0.00    1.00     1  mysqld
01时59分33秒   998      4303    0.00    0.00    0.00    0.00     1  mysqld
01时59分34秒   998      4303    1.00    0.00    0.00    1.00     1  mysqld
01时59分35秒   998      4303    0.00    0.00    0.00    0.00     1  mysqld
01时59分36秒   998      4303    0.00    1.00    0.00    1.00     2  mysqld
01时59分37秒   998      4303    1.00    0.00    0.00    1.00     2  mysqld
01时59分38秒   998      4303    0.00    0.00    0.00    0.00     2  mysqld
01时59分39秒   998      4303    0.00    0.00    0.00    0.00     2  mysqld
01时59分40秒   998      4303    1.00    1.00    0.00    2.00     2  mysqld
01时59分41秒   998      4303    0.00    0.00    0.00    0.00     2  mysqld
01时59分42秒   998      4303    1.00    0.00    0.00    1.00     2  mysqld
01时59分43秒   998      4303    0.00    0.00    0.00    0.00     2  mysqld
01时59分44秒   998      4303    2.97    1.98    0.00    4.95     2  mysqld
01时59分45秒   998      4303    1.00    0.00    0.00    1.00     2  mysqld
01时59分46秒   998      4303    0.00    1.00    0.00    1.00     2  mysqld
01时59分47秒   998      4303   20.00   24.00    0.00   44.00     0  mysqld
01时59分48秒   998      4303   98.00   77.00    0.00  175.00     0  mysqld
01时59分49秒   998      4303  130.00  113.00    0.00  243.00     0  mysqld
01时59分50秒   998      4303  141.00  112.00    0.00  253.00     0  mysqld
01时59分51秒   998      4303  149.00   95.00    0.00  244.00     0  mysqld
01时59分52秒   998      4303  121.00   94.00    0.00  215.00     0  mysqld
01时59分53秒   998      4303  141.00  110.00    0.00  251.00     0  mysqld
01时59分54秒   998      4303  140.00  103.00    0.00  243.00     0  mysqld
01时59分55秒   998      4303  124.00   92.00    0.00  216.00     0  mysqld
01时59分56秒   998      4303  136.00  105.00    0.00  241.00     0  mysqld
01时59分57秒   998      4303  138.00  102.00    0.00  240.00     0  mysqld
01时59分58秒   998      4303  112.00   82.00    0.00  194.00     0  mysqld
01时59分59秒   998      4303  138.00  106.00    0.00  244.00     0  mysqld
02时00分00秒   998      4303  136.00  106.00    0.00  242.00     0  mysqld
02时00分01秒   998      4303  131.00  101.00    0.00  232.00     0  mysqld
02时00分02秒   998      4303   46.00   37.00    0.00   83.00     0  mysqld
02时00分03秒   998      4303  140.00  106.00    0.00  246.00     0  mysqld
02时00分04秒   998      4303  143.00  104.00    0.00  247.00     0  mysqld
02时00分05秒   998      4303  127.00   99.00    0.00  226.00     0  mysqld
02时00分06秒   998      4303  147.00  105.00    0.00  252.00     0  mysqld
02时00分07秒   998      4303  126.00  102.00    0.00  228.00     0  mysqld
02时00分08秒   998      4303  129.00   95.00    0.00  224.00     0  mysqld
02时00分09秒   998      4303  141.00  103.00    0.00  244.00     0  mysqld
02时00分10秒   998      4303  125.00   93.00    0.00  218.00     0  mysqld
02时00分11秒   998      4303  138.00  105.00    0.00  243.00     0  mysqld

02时00分11秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
02时00分12秒   998      4303  142.00  113.00    0.00  255.00     0  mysqld
02时00分13秒   998      4303  125.00   94.00    0.00  219.00     0  mysqld
02时00分14秒   998      4303   78.00   61.00    0.00  139.00     0  mysqld
02时00分15秒   998      4303  134.00  107.00    0.00  241.00     0  mysqld
02时00分16秒   998      4303  142.57  107.92    0.00  250.50     0  mysqld
02时00分17秒   998      4303  137.00  102.00    0.00  239.00     0  mysqld
02时00分18秒   998      4303  140.00  105.00    0.00  245.00     0  mysqld
02时00分20秒   998      4303  124.00  106.00    0.00  230.00     0  mysqld
02时00分21秒   998      4303  128.00   94.00    0.00  222.00     0  mysqld
02时00分22秒   998      4303  142.00  114.00    0.00  256.00     0  mysqld
02时00分23秒   998      4303  140.00  114.00    0.00  254.00     0  mysqld

平均时间:   998      4303   82.88   63.55    0.00  146.43     -  mysqld

# 输出指定pid的CPU统计信息
[root@localhost ~]# pidstat -u -p 4303 1
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

02时00分29秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
02时00分30秒   998      4303  134.00  100.00    0.00  234.00     0  mysqld
02时00分31秒   998      4303  120.00   94.00    0.00  214.00     0  mysqld
02时00分32秒   998      4303  143.00  104.00    0.00  247.00     0  mysqld
^C
平均时间:   998      4303  132.33   99.33    0.00  231.67     -  mysqld

# 输出指定进程的内存统计信息
[root@localhost ~]# pidstat -r -p 4303 1   
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

02时00分59秒   UID       PID  minflt/s  majflt/s     VSZ    RSS   %MEM  Command
02时01分00秒   998      4303      0.00      0.00 2793112 167380   8.95  mysqld
02时01分01秒   998      4303    228.00      0.00 2793112 167380   8.95  mysqld
02时01分02秒   998      4303      0.00      0.00 2793112 167360   8.95  mysqld
02时01分03秒   998      4303      3.00      2.00 2793112 167356   8.95  mysqld
02时01分04秒   998      4303    226.00      1.00 2793112 168112   8.99  mysqld
02时01分05秒   998      4303      0.00      0.00 2793112 167352   8.95  mysqld
02时01分06秒   998      4303      0.00      1.00 2793112 167352   8.95  mysqld
02时01分07秒   998      4303      3.92      0.98 2793112 167352   8.95  mysqld
02时01分08秒   998      4303     95.00      4.00 2793112 167624   8.96  mysqld
02时01分09秒   998      4303    226.00      0.00 2793112 167652   8.96  mysqld
02时01分10秒   998      4303      0.00      0.00 2793112 167652   8.96  mysqld
02时01分11秒   998      4303    227.00      0.00 2793112 167648   8.96  mysqld
02时01分12秒   998      4303      0.00      0.00 2793112 167648   8.96  mysqld
02时01分13秒   998      4303    227.00      0.00 2793112 167648   8.96  mysqld
02时01分14秒   998      4303      2.00      0.00 2793112 167648   8.96  mysqld
02时01分15秒   998      4303    226.00      0.00 2793112 167640   8.96  mysqld
^C
平均时间:   998      4303     91.04      0.56 2793112 167550   8.96  mysqld

# 输出I/O的统计信息
[root@localhost ~]# pidstat -d
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

02时01分32秒   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command
02时01分32秒     0         1     49.20      0.09      0.01  systemd
02时01分32秒     0       653      0.00      0.00      0.00  kworker/u256:29
02时01分32秒     0       746      0.02      0.00      0.00  xfsaild/dm-0
02时01分32秒     0       822      1.05      0.00      0.00  systemd-journal
02时01分32秒     0       835      0.02      0.00      0.00  lvmetad
02时01分32秒     0       843      5.14      0.00      0.00  systemd-udevd
02时01分32秒     0       959      0.85      0.15      0.00  auditd
02时01分32秒     0       981      5.21      0.00      0.00  firewalld
02时01分32秒     0       986      0.46      0.00      0.00  irqbalance
02时01分32秒     0       987      1.63      0.12      0.00  rsyslogd
02时01分32秒     0       988      3.81      0.01      0.00  tuned
02时01分32秒     0       991      0.65      0.00      0.00  systemd-logind
02时01分32秒    81       992      1.05      0.00      0.00  dbus-daemon
02时01分32秒     0       996      9.42      0.01      0.00  crond
02时01分32秒     0      1004      0.02      0.00      0.00  agetty
02时01分32秒     0      1099      9.04      0.01      0.00  NetworkManager
02时01分32秒   999      1300      4.15      0.00      0.00  polkitd
02时01分32秒     0      1580      4.13      0.01      0.00  dhclient
02时01分32秒     0      1608      0.64      0.00      0.00  sshd
02时01分32秒     0      2826      5.21      0.00      0.00  sshd
02时01分32秒     0      2830     23.59      0.01      0.00  bash
02时01分32秒     0      2851     53.59      3.08      0.12  bash
02时01分32秒     0      2878      0.01      0.00      0.00  mysqld_safe
02时01分32秒   998      4303     41.58   1891.53      4.24  mysqld
02时01分32秒     0      4714      0.00      7.51      0.00  kworker/u256:1
02时01分32秒     0      4726     27.46      2.16      0.00  java
02时01分32秒     0      4751      0.00      8.99      0.00  kworker/u256:0
02时01分32秒     0      4786      2.79      0.00      0.00  pidstat

# 输出指定进程I/O的统计信息
[root@localhost ~]# pidstat -d -p 4303 1
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

02时01分43秒   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command
02时01分44秒   998      4303     35.64  14756.44      0.00  mysqld
02时01分45秒   998      4303    124.00  19640.00      0.00  mysqld
02时01分46秒   998      4303     44.00  17540.00      0.00  mysqld
02时01分47秒   998      4303     16.00  16740.00      0.00  mysqld
02时01分48秒   998      4303     44.00  18280.00      0.00  mysqld
02时01分49秒   998      4303     48.00  14132.00      0.00  mysqld
02时01分50秒   998      4303   1300.00  18500.00      0.00  mysqld
02时01分51秒   998      4303    728.00  12368.00      0.00  mysqld
02时01分52秒   998      4303   5348.00  18224.00      0.00  mysqld
02时01分53秒   998      4303     16.00  11244.00      0.00  mysqld
^C
平均时间:   998      4303    769.63  16141.06      0.00  mysqld

# 输出正则匹配的进程统计信息
[root@localhost ~]# pidstat -C mysql 1
Linux 3.10.0-229.el7.x86_64 (localhost.localdomain)     2016年02月01日  _x86_64_        (4 CPU)

02时23分57秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
02时23分58秒   998      4303    8.91   77.23    0.00   86.14     3  mysqld

02时23分58秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
02时23分59秒   998      4303   16.83   35.64    0.00   52.48     3  mysqld

02时23分59秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
02时24分00秒   998      4303    5.00   27.00    0.00   32.00     3  mysqld
^C

平均时间:   UID       PID    %usr %system  %guest    %CPU   CPU  Command
平均时间:   998      4303   10.26   46.69    0.00   56.95     -  mysqld
```
**pidstat的选项详解：  **
##### -C comm
输出与*comm*模糊匹配的进程。  
##### -d
输出I/O统计信息。  
- UID 任务的UID  
- USER 任务的所有者  
- PID 任务的进程号  
- kB_rd/s 每秒进程从磁盘读取的数据量（单位：kB）
- kB_wr/s 每秒进程向磁盘写的数据量（单位：kB）
- kB_ccwr/s 

